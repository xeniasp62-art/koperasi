/* =====================
   INIT
===================== */
function initSimpanan(){
  loadAnggota();
  loadSimpanan();
  setTanggalHariIni();
}

/* =====================
   UTIL
===================== */
function rupiah(n){
  return "Rp " + Number(n || 0).toLocaleString("id-ID");
}

/* =====================
   LOAD ANGGOTA
===================== */
function loadAnggota(){
  const db = getDB();
  const sel = document.getElementById("anggota");

  sel.innerHTML = `<option value="">-- Pilih Anggota --</option>`;

  if(!db.anggota || db.anggota.length === 0) return;

  db.anggota.forEach(a=>{
    const opt = document.createElement("option");
    opt.value = a.nama;
    opt.textContent = a.nama;
    sel.appendChild(opt);
  });
}

/* =====================
   SIMPAN SIMPANAN
===================== */
function simpanSimpanan(e){
  e.preventDefault();

  const db = getDB();
  if(!db.simpanan) db.simpanan = [];

  const data = {
    id: Date.now(),
    nama: document.getElementById("anggota").value,
    jenis: document.getElementById("jenis").value,
    jumlah: Number(document.getElementById("jumlah").value),
    tanggal: document.getElementById("tanggal").value
  };

  db.simpanan.push(data);
  saveDB(db);

  e.target.reset();
  setTanggalHariIni();
  loadSimpanan();

  alert("âœ… Simpanan berhasil disimpan");
}

/* =====================
   LOAD TABEL SIMPANAN
===================== */
function loadSimpanan(){
  const db = getDB();
  const tbody = document.getElementById("listSimpanan");

  tbody.innerHTML = "";

  if(!db.simpanan || db.simpanan.length === 0){
    tbody.innerHTML = `<tr><td colspan="5">Belum ada data</td></tr>`;
    return;
  }

  db.simpanan.forEach((s,i)=>{
    tbody.innerHTML += `
      <tr>
        <td>${s.tanggal}</td>
        <td>${s.nama}</td>
        <td>${s.jenis}</td>
        <td>${rupiah(s.jumlah)}</td>
        <td>
          <button onclick="hapusSimpanan(${i})">ðŸ—‘</button>
        </td>
      </tr>
    `;
  });
}

/* =====================
   HAPUS DATA
===================== */
function hapusSimpanan(index){
  if(!confirm("Hapus data ini?")) return;

  const db = getDB();
  db.simpanan.splice(index,1);
  saveDB(db);
  loadSimpanan();
}

/* =====================
   SET TANGGAL OTOMATIS
===================== */
function setTanggalHariIni(){
  const tgl = document.getElementById("tanggal");
  if(tgl) tgl.value = new Date().toISOString().slice(0,10);
}